<?php

//-- Schede_a ----------------------------------------------------

function saveInfoDescrpA($dati, $proprieta, $particella) {
// scorrere oggetto co
// for( $dati as $key )
// $str_$key = (isset($dati->$key))
$str_toponimo   = (isset($dati->toponimo) and $dati->toponimo!='')	? "toponimo='".$dati->toponimo."'" 	: "toponimo=null";
$str_comune	=(isset($dati->comune) and $dati->comune!='')		? "comune='".$dati->comune."'" 		: "comune=null";
$str_codiope	=(isset($dati->codiope) and $dati->codiope!='')	? "codiope='".$dati->codiope."'" 	: "codiope=null";
$str_datasch	=(isset($dati->datasch) and $dati->datasch!='')	? "datasch='".$dati->datasch."'" 	: "datasch=null";
$str_e1		=(isset($dati->e1))		? "e1='".$dati->e1."'" 			: "e1=null";
$str_pf1	=(isset($dati->pf1))		? "pf1='".$dati->pf1."'" 		: "pf1=null";

$str_a2		=(isset($dati->a2))		? "a2='".$dati->a2."'" 			: "a2=null";
$str_a3		=(isset($dati->a3))		? "a3='".$dati->a3."'" 			: "a3=null";
$str_a4		=(isset($dati->a4))		? "a4='".$dati->a4."'" 			: "a4=null";
$str_a6		=(isset($dati->a6))		? "a6='".$dati->a6."'" 			: "a6=null";
$str_a7		=(isset($dati->a7))		? "a7='".$dati->a7."'" 			: "a7=null";
$str_a8		=(isset($dati->a8) and $dati->a8!='')		? "a8='".$dati->a8."'" 			: "a8=null";

$str_r2		=(isset($dati->r2))		? "r2='".$dati->r2."'" 			: "r2=null";
$str_r3		=(isset($dati->r3))		? "r3='".$dati->r3."'" 			: "r3=null";
$str_r4		=(isset($dati->r4))		? "r4='".$dati->r4."'" 			: "r4=null";
$str_r5		=(isset($dati->r5))		? "r5='".$dati->r5."'" 			: "r5=null";
$str_r6		=(isset($dati->r6))		? "r6='".$dati->r6."'" 			: "r6=null";
$str_r7		=(isset($dati->r7) and $dati->r7!='')		? "r7='".$dati->r7."'" 			: "r7=null";

$str_f2		=(isset($dati->f2))		? "f2='".$dati->f2."'" 			: "f2=null";
$str_f3		=(isset($dati->f3))		? "f3='".$dati->f3."'" 			: "f3=null";
$str_f4		=(isset($dati->f4))		? "f4='".$dati->f4."'" 			: "f4=null";
$str_f5		=(isset($dati->f5))		? "f5='".$dati->f5."'" 			: "f5=null";
$str_f6		=(isset($dati->f6))		? "f6='".$dati->f6."'" 			: "f6=null";
$str_f7		=(isset($dati->f7))		? "f7='".$dati->f7."'" 			: "f7=null";
$str_f8		=(isset($dati->f8))		? "f8='".$dati->f8."'" 			: "f8=null";
$str_f10	=(isset($dati->f10))		? "f10='".$dati->f10."'" 		: "f10=null";
$str_f11	=(isset($dati->f11))		? "f11='".$dati->f11."'" 		: "f11=null";
$str_f12	=(isset($dati->f12) and $dati->f12!='')		? "f12='".$dati->f12."'" 			: "f12=null";

$str_o		=(isset($dati->o))		? "o='".$dati->o."'" 			: "o=null";

$str_p7		=(isset($dati->p7))		? "p7='".$dati->p7."'" 			: "p7=null";
$str_p8		=(isset($dati->p8) and $dati->p8!='')		? "p8='".$dati->p8."'" 			: "p8=null";
$str_p9		=(isset($dati->p9) and $dati->p9!='')		? "p9='".$dati->p9."'" 			: "p9=null";

$str_m19	=(isset($dati->m19) and $dati->m19!='')		? "m19='".$dati->m19."'" 		: "m19=null";
$str_c6		=(isset($dati->c6) and $dati->c6!='')		? "c6='".$dati->c6."'" 			: "c6=null";
$str_i8		=(isset($dati->i8) and $dati->i8!='')		? "i8='".$dati->i8."'" 			: "i8=null";
// $str_	=(isset($dati->)		? "='".$dati->."'" 			: "=null";
$str_delimitata = (isset($dati->delimitata))	? "delimitata='".$dati->delimitata."'" 	: "delimitata=null";
$str_note = (isset($dati->note) and $dati->note!='')		? "note='".$dati->note."'" 		: "note=null";
//  query corrispondente al tasto "Modifica"
$query = "UPDATE schede_a SET 
		ap=$dati->ap, pp=$dati->pp, $str_toponimo, $str_datasch, $str_delimitata, $str_comune, $str_codiope,
		$str_e1, $str_pf1,
		$str_a2, $str_a3, $str_a4, $str_a6, $str_a7, $str_a8,
		$str_r2, $str_r3, $str_r4, $str_r5, $str_r6, $str_r7,
		$str_f2, $str_f3, $str_f4, $str_f5, $str_f6, $str_f7, $str_f8, 
		$str_f10, $str_f11, $str_f12,
		v3=$dati->v3, v1=$dati->v1, $str_o, 
		c1=$dati->c1, c2 =$dati->c2, c3=$dati->c3, c4=$dati->c4, c5=$dati->c5, $str_c6,
		p1=$dati->p1, p2 =$dati->p2, p3=$dati->p3, p4=$dati->p4, p5=$dati->p5, p6=$dati->p6, $str_p7, $str_p8, $str_p9,
		i1=$dati->i1, i2=$dati->i2, i3=$dati->i3, i4=$dati->i4, i5=$dati->i5, i6=$dati->i6 ,i7=$dati->i7, $str_i8, i21=$dati->i21, i22=$dati->i22,
		m1=$dati->m1, m2=$dati->m2, m21=$dati->m21, m3=$dati->m3, m4=$dati->m4, m22=$dati->m22, m20=$dati->m20, m5=$dati->m5, m6=$dati->m6, m7=$dati->m7, m8=$dati->m8,
		m9=$dati->m9, m10=$dati->m10, m12=$dati->m12, m13=$dati->m13, m15=$dati->m15, m14=$dati->m14, m23=$dati->m23,  m16=$dati->m16, m17=$dati->m17 ,m18=$dati->m18 , $str_m19,
		$str_note, sup=$dati->sup, sup_tot=$dati->sup_tot
	WHERE proprieta = '$proprieta' AND cod_part='$particella'
	RETURNING cod_part";
$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;
// echo "query0".$query;

if( pg_num_rows($res) == 0 ) {	// se non viene eseguita la query viene passato il numero '0', cioè sono state eseguite 0 righe di query
$str_toponimo   = (isset($dati->toponimo) and $dati->toponimo!='')	? "'".$dati->toponimo."'" 	: "null";
$str_comune	=(isset($dati->comune) and $dati->comune!='')		? "'".$dati->comune."'" 	: "null";
$str_codiope	=(isset($dati->codiope) and $dati->codiope!='')		? "'".$dati->codiope."'" 	: "null";
$str_datasch	=(isset($dati->datasch) and $dati->datasch!='')		? "'".$dati->datasch."'" 	: "null";
$str_e1		=(isset($dati->e1))		? "'".$dati->e1."'" 		: "null";
$str_pf1	=(isset($dati->pf1))		? "'".$dati->pf1."'" 		: "null";

$str_a2		=(isset($dati->a2))		? "'".$dati->a2."'" 		: "null";
$str_a3		=(isset($dati->a3))		? "'".$dati->a3."'" 		: "null";
$str_a4		=(isset($dati->a4))		? "'".$dati->a4."'" 		: "null";
$str_a6		=(isset($dati->a6))		? "'".$dati->a6."'" 		: "null";
$str_a7		=(isset($dati->a7))		? "'".$dati->a7."'" 		: "null";
$str_a8		=(isset($dati->a8) and $dati->a8!='')		? "'".$dati->a8."'" 		: "null";

$str_r2		=(isset($dati->r2))		? "'".$dati->r2."'" 		: "null";
$str_r3		=(isset($dati->r3))		? "'".$dati->r3."'" 		: "null";
$str_r4		=(isset($dati->r4))		? "'".$dati->r4."'" 		: "null";
$str_r5		=(isset($dati->r5))		? "'".$dati->r5."'" 		: "null";
$str_r6		=(isset($dati->r6))		? "'".$dati->r6."'" 		: "null";
$str_r7		=(isset($dati->r7) and $dati->r7!='')		? "'".$dati->r7."'" 			: "null";

$str_f2		=(isset($dati->f2))		? "'".$dati->f2."'" 		: "null";
$str_f3		=(isset($dati->f3))		? "'".$dati->f3."'" 		: "null";
$str_f4		=(isset($dati->f4))		? "'".$dati->f4."'" 		: "null";
$str_f5		=(isset($dati->f5))		? "'".$dati->f5."'" 		: "null";
$str_f6		=(isset($dati->f6))		? "'".$dati->f6."'" 		: "null";
$str_f7		=(isset($dati->f7))		? "'".$dati->f7."'" 		: "null";
$str_f8		=(isset($dati->f8))		? "'".$dati->f8."'" 		: "null";
$str_f10	=(isset($dati->f10))		? "'".$dati->f10."'" 		: "null";
$str_f11	=(isset($dati->f11))		? "'".$dati->f11."'" 		: "null";
$str_f12	=(isset($dati->f12) and $dati->f12!='')		? "'".$dati->f12."'" 			: "null";

$str_o		=(isset($dati->o))		? "'".$dati->o."'" 		: "null";

$str_p7		=(isset($dati->p7))		? "'".$dati->p7."'" 		: "null";
$str_p8		=(isset($dati->p8) and $dati->p8!='')		? "'".$dati->p8."'" 		: "null";
$str_p9		=(isset($dati->p9) and $dati->p9!='')		? "'".$dati->p9."'" 		: "null";

$str_m19	=(isset($dati->m19) and $dati->m19!='')		? "'".$dati->m19."'" 		: "null";
$str_c6		=(isset($dati->c6) and $dati->c6!='')		? "'".$dati->c6."'" 		: "null";
$str_i8		=(isset($dati->i8) and $dati->i8!='')		? "'".$dati->i8."'" 		: "null";
$str_delimitata = (isset($dati->delimitata))	? "'".$dati->delimitata."'"	: "null";
$str_note = (isset($dati->note))		? "'".$dati->note."'" 		: "null";
//  query corrispondente al tasto "Inserisci"
	$query1 = "INSERT INTO schede_a( 
	      ap, pp, toponimo, datasch, delimitata,
	      comune, codiope, proprieta, cod_part,
	      e1,pf1, 
	      a2 ,a3 ,  a4 , a6 , a7 , a8,
	      r2, r3, r4, r5, r6, r7,
	      f2, f3, f4, f5, f6, f7, f8, f10, f11, f12,
	      v3, v1, o,
	      c1,c2, c3,c4,c5,c6,
	      p1,p2, p3, p4, p5, p6, p7, p8,  p9,
	      i1, i2, i3, i4, i5, i6, i7, i8, i21, i22,
	      m1, m2, m21, m3, m4, m22, m20, m5,m6,m7,m8,
	      m9, m10, m12, m13, m15, m14, m23, m16, m17, m18,m19,
	      note, sup, sup_tot)
		VALUES
		($dati->ap , $dati->pp , $str_toponimo, $str_datasch, $str_delimitata,
		 $str_comune , $str_codiope , '$proprieta', '$particella',
		 $str_e1, $str_pf1,
		 $str_a2, $str_a3, $str_a4, $str_a6, $str_a7, $str_a8,
		 $str_r2, $str_r3, $str_r4, $str_r5, $str_r6, $str_r7,
		 $str_f2, $str_f3, $str_f4, $str_f5, $str_f6, $str_f7, $str_f8, $str_f10, $str_f11, $str_f12,
		$dati->v3, $dati->v1, $str_o, 
		'$dati->c1', '$dati->c2', '$dati->c3', '$dati->c4', '$dati->c5', $str_c6,
		'$dati->p1', '$dati->p2', '$dati->p3', '$dati->p4', '$dati->p5', '$dati->p6', $str_p7, $str_p8, $str_p9,
		$dati->i1, $dati->i2, '$dati->i3', '$dati->i4', '$dati->i5', '$dati->i6', '$dati->i7', $str_i8, $dati->i21, $dati->i22,
		'$dati->m1' , '$dati->m2', $dati->m21 ,'$dati->m3', '$dati->m4', $dati->m22 ,'$dati->m20' ,'$dati->m5' ,'$dati->m6' , '$dati->m7' ,'$dati->m8' ,
		'$dati->m9', '$dati->m10' , '$dati->m12' ,'$dati->m13'  ,'$dati->m15' ,'$dati->m14' ,'$dati->m23' ,'$dati->m16' ,'$dati->m17' , '$dati->m18' ,$str_m19,
		$str_note, $dati->sup, $dati->sup_tot)";
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );
	//faccio $query2 per inserire anche la particella nella scheda_b. devo forzare anche il valore di u (convenzionalmente a 00) perchè sennò mi da errore. SISTEMARE U FORZATOOOOOO!!!!!
//  	$query2 = "INSERT INTO schede_b( proprieta, cod_part, u ) VALUES ('$proprieta', '$particella', null)"; 
//  	$res2 = pg_query($query2) or die( __FUNCTION__."$query2<br />".pg_last_error() );
// echo "query1".$query1;
	}
if( pg_num_rows($res) == 0 )  echo "<b><i>'Inserimento dati' avvenuto con successo.</i></b>";
else echo "<b><i>'Modifica dati' avvenuta con successo.</i></b>";
return ($res) ;
}

function cancellaPartA ($proprieta, $particella) {
	$query = " 	DELETE FROM schede_a 
			WHERE proprieta='$proprieta' AND cod_part='$particella'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione dati' bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}
// ------------ formA2 --------------------------
function saveInfoDescrpA_note($dati, $proprieta, $particella) {
	$str_nota	=(isset($dati->nota) and  $dati->nota!='')		? "nota='".$dati->nota."'" 		: "nota=null";

	$query = "UPDATE note_a SET 
		 $str_nota
		WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_nota='$dati->cod_nota'
		RETURNING cod_part";
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;


    if( pg_num_rows($res) == 0 ) {
	$str_cod_nota	=(isset($dati->cod_nota) and  $dati->cod_nota!='')	? "'".$dati->cod_nota."'" 	: "''";
	$str_nota	=(isset($dati->nota) and  $dati->nota!='')		? "'".$dati->nota."'" 		: "null";

	$query1 = "	INSERT INTO note_a(proprieta, cod_part, cod_nota, nota) 
		VALUES ('$proprieta', '$particella', $str_cod_nota, $str_nota )" ;
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );	

    }
	if( pg_num_rows($res) == 0 )  {echo "<b><i>' Inserimento note A' avvenuto con successo.</i></b>";}
	else echo "<b><i>'Modifica note A' avvenuta con successo.</i></b>";
	return ($res) ;
}


function cancellaPartA_note ($proprieta, $particella, $cod_nota){
	$query = " 	DELETE FROM note_a 
			WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_nota='$cod_nota'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione note' di bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}

///////////////////////////////////////////
//-- Schede_b ----------------------------------------------------
///////////////////////////////////////////
// Attenzione imposto valori costanti:
//cod_fo = ' 1' (non so bene perchè ma è costante)
//u = '1' -> impongo 1 perchè sempre scheda B1

function saveInfoDescrpB ($dati, $proprieta, $particella) {
	$str_cod_fo	=(isset($dati->cod_fo))		? "cod_fo='".$dati->cod_fo."'" 	: "cod_fo=' 1'";
	$id_av = array();
	$id_av = $proprieta.$particella."1";
	$str_id_av	=(isset($dati->id_av))		? "id_av='".$dati->id_av."'" 	: "id_av='".$id_av."'";
	$str_u	=(isset($dati->u))			? "u='".$dati->u."'" 		: "u='1'";
	$str_t	=(isset($dati->t) and $dati->t!='')	? "t='".$dati->t."'" 		: "t=null";

	$query = "UPDATE schede_b SET $str_cod_fo, $str_id_av, $str_u, sup=$dati->sup, $str_t
		  WHERE proprieta = '$proprieta' AND cod_part='$particella'
		  RETURNING cod_part" ;
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;

if( pg_num_rows($res) == 0 ) {	// se non viene eseguita la query viene passato il numero '0', cioè sono state eseguite 0 righe di query
	$str_cod_fo	=(isset($dati->cod_fo))	? "'".$dati->cod_fo."'" 	: "' 1'";
	$str_id_av	=(isset($dati->id_av))	? "'".$dati->id_av."'" 		: "'".$id_av."'";
	$str_u		=(isset($dati->u))	? "'".$dati->u."'" 		: "'1'";
	$str_t		=(isset($dati->t) and $dati->t!='')	? "'".$dati->t."'" 		: "null";

	$query1 ="INSERT INTO schede_b	( proprieta, cod_part, cod_fo, id_av, u, sup, t)
		VALUES			('$proprieta', '$particella', $str_cod_fo, $str_id_av, $str_u, $dati->sup, $str_t)" ;
	$res = pg_query($query1) or die(" <br />". __FUNCTION__." $query1<br />".pg_last_error() );
	}


if( pg_num_rows($res) == 0 ) {echo "<b><i>'Inserimento dati Schede_b avvenuto con successo.</i></b>"; }
else {			echo "<b><i>'Modifica dati' Schede_b avvenuta con successo.</i></b>";}

      return ($res) ;
}
function cancellaPartB($proprieta, $particella) {
	$query = " 	DELETE FROM schede_b 
			WHERE proprieta='$proprieta' AND cod_part='$particella';" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione dati' bosco ($proprieta) $particella avvenuta con successo in schede_b.</i></b>";
	return array(($res),null) ;
}

// ###########    ###########
function saveInfoDescrpB1 ($dati, $proprieta, $particella){
	$str_cod_fo	=(isset($dati->cod_fo))		? "cod_fo='".$dati->cod_fo."'" 	: "cod_fo=' 1'";
	$str_id_av	=(isset($dati->id_av))		? "id_av='".$dati->id_av."'" 	: "id_av=null";
	$str_l	=(isset($dati->l))			? "l='".$dati->l."'" 		: "l=null";
	$str_l1	=(isset($dati->l1))			? "l1='".$dati->l1."'" 		: "l1=null";
	$str_e1	=(isset($dati->e1))			? "e1='".$dati->e1."'" 		: "e1=null";
	$str_u	=(isset($dati->u))			? "u='".$dati->u."'" 		: "u='1'";
	$str_g	=(isset($dati->g))			? "g='".$dati->g."'" 		: "g=null";
	$str_s	=(isset($dati->s) and $dati->s!='-1')	? "s='".$dati->s."'" 		: "s=null";
	$str_m	=(isset($dati->m))			? "m='".$dati->m."'" 		: "m=null";
	$str_ce_mat	=(isset($dati->ce_mat))		? "ce_mat='".$dati->ce_mat."'" 	: "ce_mat=null";
	$str_o	=(isset($dati->o))			? "o='".$dati->o."'" 		: "o=null";
	$str_n_agam	=(isset($dati->n_agam))		? "n_agam='".$dati->n_agam."'" 	: "n_agam=null";
	$str_senescenti	=(isset($dati->senescenti))	? "senescenti='".$dati->senescenti."'" 	: "senescenti=null";
	$str_colt_cast	=(isset($dati->colt_cast))	? "colt_cast='".$dati->colt_cast."'" 	: "colt_cast=null";
	$str_sr	=(isset($dati->sr))			? "sr='".$dati->sr."'" 		: "sr=null";
	$str_se	=(isset($dati->se))			? "se='".$dati->se."'" 		: "se=null";
	$str_morta	=(isset($dati->morta))		? "morta='".$dati->morta."'" 	: "morta=null";
	$str_alberiterr	=(isset($dati->alberiterr))	? "alberiterr='".$dati->alberiterr."'" 	: "alberiterr=null";
	$str_prep_terr	=(isset($dati->prep_terr))	? "prep_terr='".$dati->prep_terr."'" 	: "prep_terr=null";
	$str_vig	=(isset($dati->vig))		? "vig='".$dati->vig."'" 		: "vig=null";
	$str_v	=(isset($dati->v))			? "v='".$dati->v."'" 		: "v=null";
	$str_d	=(isset($dati->d))			? "d='".$dati->d."'" 		: "d=null";
	$str_n1	=(isset($dati->n1))			? "n1='".$dati->n1."'" 		: "n1=null";
	$str_n2	=(isset($dati->n2))			? "n2='".$dati->n2."'" 		: "n2=null";
	$str_n3	=(isset($dati->n3))			? "n3='".$dati->n3."'" 		: "n3=null";
	$str_spe_nov	=(isset($dati->spe_nov) or $dati->spe_nov!='-1')	? "spe_nov='".$dati->spe_nov."'" : "spe_nov=null";
	$str_f	=(isset($dati->f) or $dati->f!='-1')	? "f='".$dati->f."'" 		: "f=null";
	$str_f2	=(isset($dati->f2))			? "f2='".$dati->f2."'" 		: "f2=null";
	$str_p2	=(isset($dati->p2) or $dati->p2!='-1')	? "p2='".$dati->p2."'" 		: "p2=null";
	$str_p3	=(isset($dati->p3) or $dati->p3!='')	? "p3='".$dati->p3."'" 		: "p3=null";
	$str_p4	=(isset($dati->p4) or $dati->p4!='')	? "p4='".$dati->p4."'" 		: "p4=null";
	$str_g1	=(isset($dati->g1))			? "g1='".$dati->g1."'" 		: "g1=null";
	$str_sub_viab	=(isset($dati->sub_viab))	? "sub_viab='".$dati->sub_viab."'" 	: "sub_viab=null";
	$str_note	=(isset($dati->note) or $dati->note!='')		? "note='".$dati->note."'" 	: "note=null";
	$str_int2	=(isset($dati->int2) or $dati->int2!='-1')		? "int2='".$dati->int2."'" 	: "int2=null";
	$str_int3	=(isset($dati->int3) or $dati->int3!='')		? "int3='".$dati->int3."'" 	: "int3=null";
	$str_tipo	=(isset($dati->tipo))		? "tipo='".$dati->tipo."'" 	: "tipo=null";
// 	$str_	=(isset($dati->))			? "='".$dati->."'" 		: "=null";

	$query = "UPDATE sched_b1 SET 	
		  $str_cod_fo, $str_id_av, sup=$dati->sup, $str_l, $str_l1, $str_e1, q1=$dati->q1, q2=$dati->q2, $str_u, $str_g, $str_s, $str_m, n_mat=$dati->n_mat, $str_ce_mat, turni=$dati->turni, $str_o, c1=$dati->c1, c2=$dati->c2, $str_n_agam, $str_senescenti, $str_colt_cast, $str_sr, $str_se,$str_morta, $str_alberiterr, $str_prep_terr, sesto_imp_tra_file=$dati->sesto_imp_tra_file, sesto_imp_su_file=$dati->sesto_imp_su_file, buche=$dati->buche, $str_vig, $str_v, ce=$dati->ce, $str_d, chiarie=$dati->chiarie, $str_n1, $str_n2, $str_n3, $str_spe_nov, $str_f, $str_f2, $str_p2, $str_p3, $str_p4, $str_g1, $str_sub_viab, d1=$dati->d1, d2=$dati->d2, d3=$dati->d3, d4=$dati->d4, d5=$dati->d5, d6=$dati->d6, d7=$dati->d7, d8=$dati->d8, d9=$dati->d9, d14=$dati->d14, d15=$dati->d15, d16=$dati->d16, $str_note, $str_int2, $str_int3,$str_tipo
		  WHERE proprieta = '$proprieta' AND cod_part='$particella'
		  RETURNING cod_part" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;

if( pg_num_rows($res) == 0 ) {	// se non viene eseguita la query viene passato il numero '0', cioè sono state eseguite 0 righe di query
	$str_cod_fo	=(isset($dati->cod_fo))		? "'".$dati->cod_fo."'" 	: "' 1'";
        $str_id_av	=(isset($dati->id_av))		? "'".$dati->id_av."'" 		: "null";
        $str_l	=(isset($dati->l))			? "'".$dati->l."'" 		: "null";
        $str_l1	=(isset($dati->l1))			? "'".$dati->l1."'" 		: "null";
        $str_e1	=(isset($dati->e1))			? "'".$dati->e1."'" 		: "null";
        $str_u	=(isset($dati->u))			? "'".$dati->u."'" 		: "'1'";
        $str_g	=(isset($dati->g))			? "'".$dati->g."'" 		: "null";
        $str_s	=(isset($dati->s) or $dati->s!='-1')	? "'".$dati->s."'" 		: "null";
        $str_m	=(isset($dati->m))			? "'".$dati->m."'" 		: "null";
        $str_ce_mat	=(isset($dati->ce_mat))		? "'".$dati->ce_mat."'" 	: "null";
        $str_o	=(isset($dati->o))			? "'".$dati->o."'" 		: "null";
        $str_n_agam	=(isset($dati->n_agam))		? "'".$dati->n_agam."'"		: "null";
        $str_senescenti	=(isset($dati->senescenti))	? "'".$dati->senescenti."'"	: "null";
        $str_colt_cast	=(isset($dati->colt_cast))	? "'".$dati->colt_cast."'" 	: "null";
        $str_sr	=(isset($dati->sr))			? "'".$dati->sr."'" 		: "null";
        $str_se	=(isset($dati->se))			? "'".$dati->se."'" 		: "null";
        $str_morta	=(isset($dati->morta))		? "'".$dati->morta."'" 		: "null";
        $str_alberiterr	=(isset($dati->alberiterr))	? "'".$dati->alberiterr."'"	: "null";
        $str_prep_terr	=(isset($dati->prep_terr))	? "'".$dati->prep_terr."'" 	: "null";
        $str_vig	=(isset($dati->vig))		? "'".$dati->vig."'" 		: "null";
        $str_v	=(isset($dati->v))			? "'".$dati->v."'" 		: "null";
        $str_d	=(isset($dati->d))			? "'".$dati->d."'" 		: "null";
        $str_n1	=(isset($dati->n1))			? "'".$dati->n1."'" 		: "null";
        $str_n2	=(isset($dati->n2))			? "'".$dati->n2."'" 		: "null";
        $str_n3	=(isset($dati->n3))			? "'".$dati->n3."'" 		: "null";
        $str_spe_nov	=(isset($dati->spe_nov) or $dati->spe_nov!='-1')	? "'".$dati->spe_nov."'"	: "null";
        $str_f	=(isset($dati->f) or $dati->f!='-1')	? "'".$dati->f."'" 		: "null";
        $str_f2	=(isset($dati->f2))			? "'".$dati->f2."'" 		: "null";
        $str_p2	=(isset($dati->p2) or $dati->p2!='-1')	? "'".$dati->p2."'" 		: "null";
        $str_p3	=(isset($dati->p3) or $dati->p3!='')	? "'".$dati->p3."'" 		: "null";
        $str_p4	=(isset($dati->p4) or $dati->p4!='')	? "'".$dati->p4."'" 		: "null";
        $str_g1	=(isset($dati->g1))			? "'".$dati->g1."'" 		: "null";
        $str_sub_viab	=(isset($dati->sub_viab))	? "'".$dati->sub_viab."'" 	: "null";
        $str_note	=(isset($dati->note) or $dati->note!='')		? "'".$dati->note."'" 		: "null";
        $str_int2	=(isset($dati->int2) or $dati->int2!='-1')		? "'".$dati->int2."'" 		: "null";
        $str_int3	=(isset($dati->int3) or $dati->int3!='')		? "'".$dati->int3."'" 		: "null";
        $str_tipo	=(isset($dati->tipo))		? "'".$dati->tipo."'" 		: "null";

 

	$query1 ="INSERT INTO sched_b1	
		( proprieta, cod_part, cod_fo, id_av, sup, l, l1, e1, q1, q2, u, g, s, m, n_mat, ce_mat, turni, o, c1, c2, n_agam, senescenti, colt_cast, sr, se, morta, alberiterr, prep_terr, sesto_imp_tra_file, sesto_imp_su_file, buche, vig, v, ce, d, chiarie, n1, n2, n3, spe_nov, f, f2, p2, p3, p4, g1, sub_viab, d1, d2, d3, d4, d5, d6, d7, d8, d9, d14, d15, d16, note, int2, int3, tipo )
		VALUES	('$proprieta', '$particella', $str_cod_fo, $str_id_av, $dati->sup, $str_l, $str_l1, $str_e1, $dati->q1, $dati->q2, $str_u, $str_g, $str_s, $str_m, $dati->n_mat, $str_ce_mat, $dati->turni, $str_o, $dati->c1, $dati->c2, $str_n_agam, $str_senescenti, $str_colt_cast, $str_sr, $str_se,$str_morta, $str_alberiterr, $str_prep_terr, $dati->sesto_imp_tra_file, $dati->sesto_imp_su_file, $dati->buche, $str_vig, $str_v, $dati->ce, $str_d, $dati->chiarie, $str_n1, $str_n2, $str_n3, $str_spe_nov, $str_f, $str_f2, $str_p2, $str_p3, $str_p4, $str_g1, $str_sub_viab, $dati->d1, $dati->d2, $dati->d3, $dati->d4, $dati->d5, $dati->d6, $dati->d7, $dati->d8, $dati->d9, $dati->d14, $dati->d15, $dati->d16, $str_note, $str_int2, $str_int3, $str_tipo)" ;
	$res = pg_query($query1) or die( __FUNCTION__." $query1<br />".pg_last_error() );
	}

if( pg_num_rows($res) == 0 )  {echo "<b><i>'Inserimento dati' Sched_b1 avvenuto con successo.</i></b>";}
else {echo "<b><i>'Modifica dati' Sched_b1 avvenuta con successo.</i></b>";}
return ($res) ;
}

function cancellaPartB1($proprieta, $particella) {
	$query = "DELETE FROM sched_b1
		  WHERE proprieta='$proprieta' AND cod_part='$particella';" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione dati' bosco ($proprieta) $particella avvenuta con successo in sched_b.</i></b>";
	return array(($res),null) ;
}

// ------------ formB1_2 --------------------------
function saveInfoDescrpB1_arbo($dati, $proprieta, $particella) {
	// $dati->cod_coltu è PK
$str_cod_coper	=(isset($dati->cod_coper) or $dati->cod_coper!='') ? "cod_coper='".$dati->cod_coper."'" : "cod_coper=null";
$str_ordine_inser=(isset($dati->ordine_inser) or $dati->ordine_inser!='') ? "ordine_inser=".$dati->ordine_inser."" : "ordine_inser=null";

	$query = "UPDATE arboree SET 
		 $str_ordine_inser, $str_cod_coper
		WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$dati->cod_coltu'
		RETURNING cod_part";
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;


    if( pg_num_rows($res) == 0 ) {
	// $dati->cod_coltu è PK
$str_cod_coper	=(isset($dati->cod_coper) or $dati->cod_coper!='')	? "'".$dati->cod_coper."'" 	: "null";
$str_ordine_inser=(isset($dati->ordine_inser) or $dati->ordine_inser!='') ? "".$dati->ordine_inser."" 	: "null";
	$query1 = "	INSERT INTO arboree (proprieta, cod_part, cod_coltu, cod_coper, ordine_inser) 
			  VALUES ('$proprieta', '$particella','$dati->cod_coltu' , $str_cod_coper, $str_ordine_inser )" ;
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );	

    }
	if( pg_num_rows($res) == 0 )  {echo "<b><i>'Inserimento specie arborea' avvenuto con successo.</i></b>";}
	else echo "<b><i>'Modifica specie arborea' avvenuta con successo.</i></b>";
	return ($res) ;
}
function cancellaPartB1_arboree ($proprieta, $particella, $cod_coltu){
	$query = " 	DELETE FROM arboree 
			WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$cod_coltu'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione specie arborea' di bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}
// ------------ formB1_4 --------------------------
function saveInfoDescrpB1_arbu($dati, $proprieta, $particella) {
	// $dati->cod_coltu è PK

	$query = "UPDATE arbusti SET 
		 cod_coltu='$dati->cod_coltu'
		WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$dati->cod_coltu_old'
		RETURNING cod_part";
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;
    if( pg_num_rows($res) == 0 ) {
// 	$dati->cod_coltu è PK
	$query1 = "	INSERT INTO arbusti (proprieta, cod_part, cod_coltu) 
			  VALUES ('$proprieta', '$particella','$dati->cod_coltu')" ;
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );	

     }
	if( pg_num_rows($res) == 0 )  {"<b><i>'Inserimento specie arbustiva' avvenuto con successo.</i></b>";}
	else "<b><i>'Modifica specie arbustiva' avvenuta con successo.</i></b>";
	return ($res) ;
}
function cancellaPartB1_arbu ($proprieta, $particella, $cod_coltu){
	$query = " 	DELETE FROM arbusti 
			WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$cod_coltu'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione specie arbustiva' di bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}
// ------------ formB1_6 --------------------------
function saveInfoDescrpB1_erba($dati, $proprieta, $particella) {
	// $dati->cod_coltu è PK

	$query = "UPDATE erbacee SET 
		 cod_coltu='$dati->cod_coltu'
		WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$dati->cod_coltu_old'
		RETURNING cod_part";
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;
    if( pg_num_rows($res) == 0 ) {
// 	$dati->cod_coltu è PK
	$query1 = "	INSERT INTO erbacee (proprieta, cod_part, cod_coltu) 
			  VALUES ('$proprieta', '$particella','$dati->cod_coltu')" ;
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );	

     }
	if( pg_num_rows($res) == 0 )  {echo "<b><i>'Inserimento specie erbacea' avvenuto con successo.</i></b>";}
	else echo "<b><i>'Modifica specie erbacea' avvenuta con successo.</i></b>";
	return ($res) ;
}
function cancellaPartB1_erba ($proprieta, $particella, $cod_coltu){
	$query = " 	DELETE FROM erbacee 
			WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$cod_coltu'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione specie erbacea' di bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}
// ------------ formB1_8 --------------------------
function saveInfoDescrpB1_note($dati, $proprieta, $particella) {
	$str_nota	=(isset($dati->nota) or  $dati->nota!='')		? "nota='".$dati->nota."'" 		: "nota=null";

	$query = "UPDATE note_b SET 
		 $str_nota
		WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_nota='$dati->cod_nota'
		RETURNING cod_part";
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;


    if( pg_num_rows($res) == 0 ) {
	$str_cod_nota	=(isset($dati->cod_nota) or  $dati->cod_nota!='')	? "'".$dati->cod_nota."'" 	: "''";
	$str_nota	=(isset($dati->nota) or  $dati->nota!='')		? "'".$dati->nota."'" 		: "null";

	$query1 = "	INSERT INTO note_b (proprieta, cod_part, cod_nota, nota) 
		VALUES ('$proprieta', '$particella', $str_cod_nota, $str_nota )" ;
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );	

    }
	if( pg_num_rows($res) == 0 )  {echo "<b><i>' Inserimento note B1' avvenuto con successo.</i></b>";}
	else echo "<b><i>'Modifica note B1' avvenuta con successo.</i></b>";
	return ($res) ;
}


function cancellaPartB1_note ($proprieta, $particella, $cod_nota){
	$query = " 	DELETE FROM note_b 
			WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_nota='$cod_nota'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione note' di bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}

// ###########    ###########

// inserire saveInfoDescrpB2
// ###########    ###########
function saveInfoDescrpB2prova($dati, $proprieta, $particella){

//  Sched_B2 contiene 69 record di cui: proprieta, cod_part, objectid.
// qui facciamo le query con 66 + 2 (proprieta, cod_part) mentre non si considera  objectid (perchè è una variabile di arcgis)
	foreach( $dati as $key => $d )
		parse_value( $dati[$key], $key, 'sched_b2'); // ritorna la variabile $dati

	$query="UPDATE sched_b2 SET ";
	$sql = array();
	foreach( $dati as $key => $d )		$sql[] = " `$key` = $d " ;
	$query .= implode($sql,','); // collego le parti della query con la virgola
	$query= $query." WHERE proprieta = '$proprieta' AND cod_part='$particella'
		  RETURNING cod_part" ;
 	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;


if( pg_num_rows($res) == 0 ) {

	$query1 ="INSERT INTO sched_b2 ( proprieta, cod_part";
	foreach ($dati As $key => $d)		$sql[] =  $key ;
	$query1 .= implode($sql,','); // collego le parti della query con la virgola
	$query1 .= ") VALUES ( '$proprieta', '$particella'";
	foreach( $dati as $key => $d )		$sql1[] =  $d  ;
	$query1 .= implode($sql1,','); // collego le parti della query con la virgola
	$query1 .= ") ";
 	$res = pg_query($query1) or die( __FUNCTION__." $query1<br />".pg_last_error() );
}

if( pg_num_rows($res) == 0 )  {echo "<b><i>'Inserimento dati' Sched_b2 avvenuto con successo.</i></b>";}
else {echo "<b><i>'Modifica dati' Sched_b2 avvenuta con successo.</i></b>";}
return ($res) ;
}

function saveInfoDescrpB2 ($dati, $proprieta, $particella){
$str_cod_fo	=(isset($dati->cod_fo))		? "cod_fo='".$dati->cod_fo."'" 	: "cod_fo=' 1'";
$str_codiope	=(isset($dati->codiope) and $dati->codiope!='')	? "codiope='".$dati->codiope."'" 	: "codiope=null";
$str_datasch	=(isset($dati->datasch) and $dati->datasch!='')	? "datasch='".$dati->datasch."'" 	: "datasch=null";
$str_id_av	=(isset($dati->id_av))		? "id_av='".$dati->id_av."'" 		: "id_av=null";
$str_u		=(isset($dati->u))		? "u='".$dati->u."'" 			: "u=null";
$str_tipo	=(isset($dati->tipo))		? "tipo='".$dati->tipo."'" 		: "tipo=null";
$str_comp_spe	=(isset($dati->comp_spe))	? "comp_spe='".$dati->comp_spe."'" 	: "comp_spe=null";
$str_cod_coltup	=(isset($dati->cod_coltup) and $dati->cod_coltup!='')	? "cod_coltup='".$dati->cod_coltup."'" 	: "cod_coltup=null";
$str_cod_coltus	=(isset($dati->cod_coltups) and $dati->cod_coltups!='')	? "cod_coltus='".$dati->cod_coltus."'" 	: "cod_coltus=null";
$str_sesto_imp_arb =(isset($dati->sesto_imp_arb))	? "sesto_imp_arb='".$dati->sesto_imp_arb."'" 	: "sesto_imp_arb=null";
$str_sesto_princ =(isset($dati->sesto_princ))	? "sesto_princ='".$dati->sesto_princ."'" 	: "sesto_princ=null";
$str_vig_arb_princ=(isset($dati->vig_arb_princ))	? "vig_arb_princ='".$dati->vig_arb_princ."'" 	: "vig_arb_princ=null";
$str_vig_arb_sec =(isset($dati->vig_arb_sec))		? "vig_arb_sec='".$dati->vig_arb_sec."'" 	: "vig_arb_sec=null";
$str_qual_pri	=(isset($dati->qual_pri))		? "qual_pri='".$dati->qual_pri."'"		: "qual_pri=null";
$str_colt_cast	=(isset($dati->colt_cast))	? "colt_cast='".$dati->colt_cast."'" 	: "colt_cast=null";
$str_vig_cast	=(isset($dati->vig_cast))	? "vig_cast='".$dati->vig_cast."'"	: "vig_cast=null";
$str_sesto_imp_cast =(isset($dati->sesto_imp_cast))	? "sesto_imp_cast='".$dati->sesto_imp_cast."'"	: "sesto_imp_cast=null";
$str_cod_coltub	=(isset($dati->cod_coltub) and $dati->cod_coltub!='-1') ? "cod_coltub='".$dati->cod_coltub."'" : "cod_coltub=null";
$str_cod_coltua	=(isset($dati->cod_coltua) and $dati->cod_coltua!='-1') ? "cod_coltua='".$dati->cod_coltua."'"	: "cod_coltua=null";
$str_fungo_ospi	=(isset($dati->fungo_ospi) and $dati->fungo_ospi!='-1')	? "fungo_ospi='".$dati->fungo_ospi."'" 	: "fungo_ospi=null";
$str_sesto_imp_tart =(isset($dati->sesto_imp_tart))	? "sesto_imp_tart='".$dati->sesto_imp_tart."'"	: "sesto_imp_tart=null";
$str_o		=(isset($dati->o))			? "o='".$dati->o."'" 		: "o=null";
$str_vig_sug	=(isset($dati->vig_sug))	? "vig_sug='".$dati->vig_sug."'" : "vig_sug=null";
$str_v		=(isset($dati->v))			? "v='".$dati->v."'" 		: "v=null";
$str_d		=(isset($dati->d))			? "d='".$dati->d."'" 		: "d=null";
$str_n1		=(isset($dati->n1))			? "n1='".$dati->n1."'" 		: "n1=null";
$str_n2		=(isset($dati->n2))			? "n2='".$dati->n2."'" 		: "n2=null";
$str_n3		=(isset($dati->n3))			? "n3='".$dati->n3."'" 		: "n3=null";
$str_spe_nov 	=(isset($dati->spe_novspe_nov) and $dati->spe_novspe_nov!='')	? "spe_nov='".$dati->spe_nov."'": "spe_nov=null";
$str_int2 	=(isset($dati->int2) and $dati->int2!='-1')		? "int2='".$dati->int2."'" 	: "int2=null";
$str_int3 	=(isset($dati->int3) and $dati->int3!='')		? "int3='".$dati->int3."'"	: "int3=null";
$str_g		=(isset($dati->g))			? "g='".$dati->g."'" 		: "g=null";
$str_sr		=(isset($dati->sr))			? "sr='".$dati->sr."'" 		: "sr=null";
$str_se		=(isset($dati->se))			? "se='".$dati->se."'" 		: "se=null";
$str_g1		=(isset($dati->g1))			? "g1='".$dati->g1."'" 		: "g1=null";
$str_sub_viab 	=(isset($dati->sub_viab ))	? "sub_viab ='".$dati->sub_viab ."'"	: "sub_viab =null";
$str_p2		=(isset($dati->p2) and $dati->p2!='-1')	? "p2='".$dati->p2."'" 		: "p2=null";
$str_p3		=(isset($dati->p3) and $dati->p3!='-1')	? "p3='".$dati->p3."'" 		: "p3=null";
$str_p4		=(isset($dati->p4) and $dati->p4!='')	? "p4='".$dati->p4."'" 		: "p4=null";
$str_note	=(isset($dati->note) and $dati->note!='')		? "note='".$dati->note."'" 	: "note=null";
$str_fito_sug 	=(isset($dati->fito_sug))		? "fito_sug='".$dati->fito_sug."'" : "fito_sug=null";
$str_s		=(isset($dati->s) and $dati->s!='')	? "s='".$dati->s."'" 		: "s=null";
$str_tipo_int_sug =(isset($dati->tipo_int_sug) and $dati->tipo_int_sug!='')	? "tipo_int_sug='".$dati->tipo_int_sug."'"	: "tipo_int_sug=null";
$str_tipo_prescr_sug =(isset($dati->tipo_prescr_sug) and $dati->tipo_prescr_sug!='')	? "tipo_prescr_sug='".$dati->tipo_prescr_sug."'" : "tipo_prescr_sug=null";
$str_estraz_passata =(isset($dati->estraz_passata) and $dati->estraz_passata!='')	? "estraz_passata='".$dati->estraz_passata."'"	: "estraz_passata=null";
$str_estraz_futura =(isset($dati->estraz_futura) and $dati->estraz_futura!='')	? "estraz_futura='".$dati->estraz_futura."'" 	: "estraz_futura=null";
$str_fito_bio_spec =(isset($dati->fito_bio_spec) and $dati->fito_bio_spec!='')	? "fito_bio_spec='".$dati->fito_bio_spec."'"	: "fito_bio_spec=null";
$str_fito_abio_spec =(isset($dati->fito_abio_spec) and $dati->fito_abio_spec!='')	? "fito_abio_spec='".$dati->fito_abio_spec."'"	: "fito_abio_spec=null";

// 	$str_	=(isset($dati->))			? "='".$dati->."'" 		: "=null";

	$query = "UPDATE sched_b2 SET 	
		  $str_cod_fo, $str_codiope, $str_datasch, $str_id_av, $str_u, $str_tipo, anno_imp=$dati->anno_imp, anno_dest=$dati->anno_dest, $str_comp_spe,  $str_cod_coltup, $str_cod_coltus, dist=$dati->dist, dist_princ=$dati->dist_princ, $str_sesto_imp_arb, $str_sesto_princ, $str_vig_arb_princ, $str_vig_arb_sec, fall=$dati->fall, $str_qual_pri, $str_colt_cast, $str_vig_cast, $str_sesto_imp_cast, $str_cod_coltub, $str_cod_coltua, $str_fungo_ospi, $str_sesto_imp_tart, num_piante=$dati->num_piante, piant_tart=$dati->piant_tart, c1=$dati->c1, $str_o, $str_vig_sug, $str_v, $str_d, $str_n1, $str_n2, $str_n3, $str_spe_nov, $str_int2, $str_int3, $str_g, ce=$dati->ce, $str_sr, $str_se, $str_g1, $str_sub_viab, $str_p2, $str_p3, $str_p4, $str_note, d1=$dati->d1, d3=$dati->d3, d5=$dati->d5, d10=$dati->d10, d11=$dati->d11, d12=$dati->d12, d13=$dati->d13, $str_fito_sug, $str_s, $str_tipo_int_sug, $str_tipo_prescr_sug, $str_estraz_passata, $str_estraz_futura, fito_bio=$dati->fito_bio, fito_abio=$dati->fito_abio, $str_fito_bio_spec, $str_fito_abio_spec
		  WHERE proprieta = '$proprieta' AND cod_part='$particella'
		  RETURNING cod_part" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;

if( pg_num_rows($res) == 0 ) {	// se non viene eseguita la query viene passato il numero '0', cioè sono state eseguite 0 righe di query
	$str_cod_fo	=(isset($dati->cod_fo))		? "'".$dati->cod_fo."'" 	: "' 1'";
	$str_codiope	=(isset($dati->codiope) and $dati->codiope!='')		? "'".$dati->codiope."'" 	: "null";
	$str_datasch	=(isset($dati->datasch) and $dati->datasch!='')		? "'".$dati->datasch."'" 	: "null";
        $str_u	=(isset($dati->u))			? "'".$dati->u."'" 		: "null";
        $str_id_av	=(isset($dati->id_av))		? "'".$dati->id_av."'" 		: "null";
        $str_tipo	=(isset($dati->tipo))		? "'".$dati->tipo."'" 		: "null";
	$str_comp_spe	=(isset($dati->comp_spe))	? "'".$dati->comp_spe."'" 	: "null";
$str_cod_coltup	=(isset($dati->cod_coltup) and $dati->cod_coltup!='')	? "'".$dati->cod_coltup."'" 	: "null";
$str_cod_coltus	=(isset($dati->cod_coltups) and $dati->cod_coltups!='')	? "'".$dati->cod_coltus."'" 	: "null";
$str_sesto_imp_arb =(isset($dati->sesto_imp_arb))	? "'".$dati->sesto_imp_arb."'" 	: "null";
$str_sesto_princ =(isset($dati->sesto_princ))		? "'".$dati->sesto_princ."'" 	: "null";
$str_vig_arb_princ=(isset($dati->vig_arb_princ))	? "'".$dati->vig_arb_princ."'" 	: "null";
$str_vig_arb_sec =(isset($dati->vig_arb_sec))		? "'".$dati->vig_arb_sec."'" 	: "null";
$str_qual_pri	=(isset($dati->qual_pri))		? "'".$dati->qual_pri."'"	: "null";
$str_colt_cast	=(isset($dati->colt_cast))		? "'".$dati->colt_cast."'" 	: "null";
$str_vig_cast	=(isset($dati->vig_cast))		? "'".$dati->vig_cast."'"	: "null";
$str_sesto_imp_cast =(isset($dati->sesto_imp_cast))	? "'".$dati->sesto_imp_cast."'"	: "null";
$str_cod_coltub	=(isset($dati->cod_coltub) and $dati->cod_coltub!='-1') ? "'".$dati->cod_coltub."'" : "null";
$str_cod_coltua	=(isset($dati->cod_coltua) and $dati->cod_coltua!='-1') ? "'".$dati->cod_coltua."'"	: "null";
$str_fungo_ospi	=(isset($dati->fungo_ospi) and $dati->fungo_ospi!='-1')	? "'".$dati->fungo_ospi."'" 	: "null";
$str_sesto_imp_tart =(isset($dati->sesto_imp_tart))	? "'".$dati->sesto_imp_tart."'"	: "null";
$str_o		=(isset($dati->o))			? "'".$dati->o."'" 		: "null";
$str_vig_sug	=(isset($dati->vig_sug))		? "'".$dati->vig_sug."'"	: "null";
$str_v		=(isset($dati->v))			? "'".$dati->v."'" 		: "null";
$str_d		=(isset($dati->d))			? "'".$dati->d."'" 		: "null";
$str_n1		=(isset($dati->n1))			? "'".$dati->n1."'" 		: "null";
$str_n2		=(isset($dati->n2))			? "'".$dati->n2."'" 		: "null";
$str_n3		=(isset($dati->n3))			? "'".$dati->n3."'" 		: "null";
$str_spe_nov 	=(isset($dati->spe_novspe_nov) and $dati->spe_novspe_nov!='')	? "'".$dati->spe_nov."'": "null";
$str_int2 	=(isset($dati->int2) and $dati->int2!='-1')		? "'".$dati->int2."'" 	: "null";
$str_int3 	=(isset($dati->int3) and $dati->int3!='')		? "'".$dati->int3."'"	: "null";
$str_g		=(isset($dati->g))			? "'".$dati->g."'" 		: "null";
$str_sr		=(isset($dati->sr))			? "'".$dati->sr."'" 		: "null";
$str_se		=(isset($dati->se))			? "'".$dati->se."'" 		: "null";
$str_g1		=(isset($dati->g1))			? "'".$dati->g1."'" 		: "null";
$str_sub_viab 	=(isset($dati->sub_viab ))		? "'".$dati->sub_viab ."'"	: "null";
$str_p2		=(isset($dati->p2) and $dati->p2!='-1')	? "'".$dati->p2."'" 		: "null";
$str_p3		=(isset($dati->p3) and $dati->p3!='-1')	? "'".$dati->p3."'" 		: "null";
$str_p4		=(isset($dati->p4) and $dati->p4!='')	? "'".$dati->p4."'" 		: "null";
$str_note	=(isset($dati->note) and $dati->note!='')		? "'".$dati->note."'" 	: "null";
$str_fito_sug 	=(isset($dati->fito_sug))		? "'".$dati->fito_sug."'" 	: "null";
$str_s		=(isset($dati->s) and $dati->s!='')	? "'".$dati->s."'" 		: "null";
$str_tipo_int_sug =(isset($dati->tipo_int_sug) and $dati->tipo_int_sug!='')		? "'".$dati->tipo_int_sug."'"	: "null";
$str_tipo_prescr_sug =(isset($dati->tipo_prescr_sug) and $dati->tipo_prescr_sug!='')	? "'".$dati->tipo_prescr_sug."'" : "null";
$str_estraz_passata =(isset($dati->estraz_passata) and $dati->estraz_passata!='')	? "'".$dati->estraz_passata."'"	: "null";
$str_estraz_futura =(isset($dati->estraz_futura) and $dati->estraz_futura!='')		? "'".$dati->estraz_futura."'" 	: "null";
$str_fito_bio_spec =(isset($dati->fito_bio_spec) and $dati->fito_bio_spec!='')		? "'".$dati->fito_bio_spec."'"	: "null";
$str_fito_abio_spec =(isset($dati->fito_abio_spec) and $dati->fito_abio_spec!='')	? "'".$dati->fito_abio_spec."'"	: "null";

	$query1 ="INSERT INTO sched_b2	
		( proprieta, cod_part, cod_fo, codiope, datasch, id_av, u, tipo, anno_imp, anno_dest, comp_spe, cod_coltup, cod_coltus, dist, dist_princ, sesto_imp_arb, sesto_princ, vig_arb_princ, vig_arb_sec, fall, qual_pri, colt_cast, vig_cast, sesto_imp_cast, cod_coltub, cod_coltua, fungo_ospi, sesto_imp_tart, num_piante, piant_tart, c1, o, vig_sug, v, d, n1, n2, n3, spe_nov, int2, int3, g, ce, sr, se, g1, sub_viab, p2, p3, p4, note, d1, d3, d5, d10, d11, d12, d13, fito_sug, s, tipo_int_sug, tipo_prescr_sug, estraz_passata, estraz_futura, fito_bio, fito_abio, fito_bio_spec, fito_abio_spec )
		VALUES	('$proprieta', '$particella', $str_cod_fo, $str_codiope, $str_datasch, $str_id_av, $str_u, $str_tipo, $dati->anno_imp, $dati->anno_dest, $str_comp_spe, $str_cod_coltup, $str_cod_coltus, $dati->dist, $dati->dist_princ, $str_sesto_imp_arb, $str_sesto_princ, $str_vig_arb_princ, $str_vig_arb_sec, $dati->fall, $str_qual_pri, $str_colt_cast, $str_vig_cast, $str_sesto_imp_cast, $str_cod_coltub, $str_cod_coltua, $str_fungo_ospi, $str_sesto_imp_tart, $dati->num_piante, $dati->piant_tart, $dati->c1, $str_o, $str_vig_sug, $str_v, $str_d, $str_n1, $str_n2, $str_n3, $str_spe_nov, $str_int2, $str_int3, $str_g, $dati->ce, $str_sr, $str_se, $str_g1, $str_sub_viab, $str_p2, $str_p3, $str_p4, $str_note, $dati->d1, $dati->d3, $dati->d5, $dati->d10, $dati->d11, $dati->d12, $dati->d13, $str_fito_sug, $str_s,$str_tipo_int_sug, $str_tipo_prescr_sug, $str_estraz_passata, $str_estraz_futura, $dati->fito_bio, $dati->fito_abio, $str_fito_bio_spec, $str_fito_abio_spec )" ;
	$res = pg_query($query1) or die( __FUNCTION__." $query1<br />".pg_last_error() );
	}

if( pg_num_rows($res) == 0 )  {echo "<b><i>'Inserimento dati' Sched_b2 avvenuto con successo.</i></b>";}
else {echo "<b><i>'Modifica dati' Sched_b2 avvenuta con successo.</i></b>";}
return ($res) ;
}
//
// ------------ formB2_2 --------------------------
function saveInfoDescrpB2_arbo($dati, $proprieta, $particella) {
	// $dati->cod_coltu è PK
echo $dati-> ordine_inser." ".$dati->cod_coper;
	$query = "UPDATE arboree2 SET 
		ordine_inser=$dati->ordine_inser, cod_coper=$dati->cod_coper
		WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$dati->cod_coltu'
		RETURNING cod_part";
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;


    if( pg_num_rows($res) == 0 ) {
	// $dati->cod_coltu è PK
	$query1 = "	INSERT INTO arboree2 (proprieta, cod_part, cod_coltu, cod_coper, ordine_inser) 
			  VALUES ('$proprieta', '$particella','$dati->cod_coltu' , $dati->cod_coper, $dati->ordine_inser )" ;
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );	

    }
	if( pg_num_rows($res) == 0 )  {echo "<b><i>'Inserimento specie arborea' avvenuto con successo.</i></b>";echo $query1;}
	else {echo "<b><i>'Modifica specie arborea' avvenuta con successo.</i></b>";echo $query;}
	return ($res) ;
}
function cancellaPartB2_arboree ($proprieta, $particella, $cod_coltu){
	$query = " 	DELETE FROM arboree2 
			WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$cod_coltu'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione specie arborea' di bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}
// ------------ formB2_4 --------------------------
function saveInfoDescrpB2_arbu($dati, $proprieta, $particella) {
	// $dati->cod_coltu è PK

	$query = "UPDATE arbusti2 SET 
		 cod_coltu='$dati->cod_coltu'
		WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$dati->cod_coltu_old'
		RETURNING cod_part";
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;
    if( pg_num_rows($res) == 0 ) {
// 	$dati->cod_coltu è PK
	$query1 = "	INSERT INTO arbusti2 (proprieta, cod_part, cod_coltu) 
			  VALUES ('$proprieta', '$particella','$dati->cod_coltu')" ;
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );	

     }
	if( pg_num_rows($res) == 0 )  {"<b><i>'Inserimento specie arbustiva' avvenuto con successo.</i></b>";}
	else "<b><i>'Modifica specie arbustiva' avvenuta con successo.</i></b>";
	return ($res) ;
}
function cancellaPartB2_arbu ($proprieta, $particella, $cod_coltu){
	$query = " 	DELETE FROM arbusti2 
			WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$cod_coltu'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione specie arbustiva' di bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}

// ------------ formB2_6 --------------------------
function saveInfoDescrpB2_erba($dati, $proprieta, $particella) {
	// $dati->cod_coltu è PK

	$query = "UPDATE erbacee2 SET 
		 cod_coltu='$dati->cod_coltu'
		WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$dati->cod_coltu_old'
		RETURNING cod_part";
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;
    if( pg_num_rows($res) == 0 ) {
// 	$dati->cod_coltu è PK
	$query1 = "	INSERT INTO erbacee2 (proprieta, cod_part, cod_coltu) 
			  VALUES ('$proprieta', '$particella','$dati->cod_coltu')" ;
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );	

     }
	if( pg_num_rows($res) == 0 )  {echo "<b><i>'Inserimento specie erbacea' avvenuto con successo.</i></b>";}
	else echo "<b><i>'Modifica specie erbacea' avvenuta con successo.</i></b>";
	return ($res) ;
}
function cancellaPartB2_erba ($proprieta, $particella, $cod_coltu){
	$query = " 	DELETE FROM erbacee2 
			WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_coltu='$cod_coltu'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione specie erbacea' di bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}
// ------------ formb2_8 --------------------------
function saveInfoDescrpB2_note($dati, $proprieta, $particella) {
	$str_nota	=(isset($dati->nota) or  $dati->nota!='')		? "nota='".$dati->nota."'" 		: "nota=null";

	$query = "UPDATE note_b2 SET 
		 $str_nota
		WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_nota='$dati->cod_nota'
		RETURNING cod_part";
	$res = pg_query($query) or die( __FUNCTION__."$query<br />".pg_last_error() ) ;


    if( pg_num_rows($res) == 0 ) {
	$str_cod_nota	=(isset($dati->cod_nota) or  $dati->cod_nota!='')	? "'".$dati->cod_nota."'" 	: "''";
	$str_nota	=(isset($dati->nota) or  $dati->nota!='')		? "'".$dati->nota."'" 		: "null";

	$query1 = "	INSERT INTO note_b2 (proprieta, cod_part, cod_nota, nota) 
		VALUES ('$proprieta', '$particella', $str_cod_nota, $str_nota )" ;
 	$res = pg_query($query1) or die( __FUNCTION__."$query1<br />".pg_last_error() );	

    }
	if( pg_num_rows($res) == 0 )  {echo "<b><i>' Inserimento note B2' avvenuto con successo.</i></b>";}
	else echo "<b><i>'Modifica note B2' avvenuta con successo.</i></b>";
	return ($res) ;
}


function cancellaPartB2_note ($proprieta, $particella, $cod_nota){
	$query = " 	DELETE FROM note_b2 
			WHERE proprieta='$proprieta' AND cod_part='$particella' AND cod_nota='$cod_nota'" ;
	$res = pg_query($query) or die( __FUNCTION__." $query<br />".pg_last_error() ) ;
	$id = pg_last_oid($res);
	echo "<b><i>'Cancellazione note' di bosco ($proprieta) $particella avvenuta con successo.</i></b><br />";
	return array(($res),null) ;
}

// ###########    ###########

?>