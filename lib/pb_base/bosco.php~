<div id='b_title'>Bosco</div>

<!-- inizio della tabella superiore che si ottine dalla query al DB -->
<?php
function tabella($conn){
?>
  <form action="?page=bosco" method="post">   <!-- FORM x gestire i campi a compilazione dell'utente (REGIONE, CODICE, DESCRIZIONE) -->
    <table>
      <thead>
	<tr> <th>Regione</th> <th>Codice</th> <th>Descrizione</th> <th colspan=2>Azioni</th></tr> 
      </thead>

      <tbody>
<?php
	  $codici = getDescrizioneBoschi();
	  foreach( $codici as $codice ){
			  echo "<tr><td>$codice->descriz</td> <td>$codice->codice</td> <td>$codice->descrizion</td>";
			  echo "<td><a href='bosco.php?azione=cancella&codice=$codice->codice'>Cancella</a></td>";
			  echo "<td><a href='bosco.php?azione=modifica&codice=$codice->codice'>Modifica</a></td></tr>";
		  }
?>

	  <tr>
	  <td><select name='regione'> <!-- visualizza elenco di opzioni, menù a tendina, necessaria voce OPTION -->
<?php
		  $ids = getDiz_regioni();
		  foreach( $ids as $id ) echo "<option value='$id->codice'> $id->descriz ($id->codice)</option>";
?>
	  </select></td>
	  <td><input TYPE="text" NAME="codice" VALUE=""></td>
	  <td><input TYPE="text" NAME="descrizion" VALUE=""></td>
	  <td colspan='2' style='text-align:center'><input type="submit" name="insert" value="Inserisci"></td>
	  </tr>
      </tbody>
    </table>
  </form>
<?
  }
?><!--qui di chiude la Function TABELLA($conn)-->

<!--inizio Function Conferma che in realtà è il tasto Cancella dentro alla tabella-->
<? //Open
  function conferma($conn, $codice) { 
// in verità questo è il comando al link Cancella
?> <!-- close-->
  <table width=80% height=60% border=0 align=center><!--tabella rosa-->
    <tr>
      <td bgcolor=#ff4040 align=center valign=middle>
	<font size=+3>Vuoi davvero cancellare questo record?</font><!--titolo della pagina-->
	<?   //Open  
	  $rubrica=pg_Exec($conn,"select codice,descrizion,regione from PROPRIET where codice='$codice';");
	  if ($indirizzo = @pg_fetch_object ($rubrica ,0)) {
	?><!-- close-->
	    <table border=1><!--contenuto della tabella interna bordata-->
	      <tr>
		<td>
		  <font size=+3>codice <b><?echo "$indirizzo->codice"?></b><br>
		  descrizione: <b><?echo "$indirizzo->descrizion"?></b><br>
		  regione: <b><?echo "$indirizzo->regione"?>
		  </font>
		</td>
	      </tr>
	    </table>
	  <? //Open
	  }
	  else {
	  ?> <!-- close-->
	    <br><font size=+3>OOPS!! non trovo il codice <?echo"$codice"?></font>
	  <? 
	  }
	  ?>
	      <table>
		<tr>
		  <td>
		    <form action=bosco.php method=get>
		      <input type=submit value=Annulla>
		    </form>
		  </td>
		  <td>
		    <form action=bosco.php method=get>
		      <input type=hidden name=azione value="cancelladavvero"> <!-- non ho capito niente di questa parte, a che cosa serve avere due righe nascoste? dov'è che le visualizza dopo?-->
		      <input type=hidden name=codice value="<?echo "$codice"?>">
		      <input type=submit value="Elimina il record">
		    </form>
		  </td>
		</tr>
	      </table>
      </td>
    </tr>
  </table>
<?
	   // echo "<br><font size=+3>OOPS!! non trovo il codice $codice</font>";}
	    //echo "<table><tr><td><form action=bosco.php method=get>\n";
	    //echo "<input type=submit value=Annulla></form></td>\n";
	   // echo "<td><form action=bosco.php method=get><input type=hidden name=azione\n";
	  //  echo "value=\"cancelladavvero\">\n";
	   // echo "<input type=hidden name=codice value=$codice><input type=submit\n"; 
	    //echo "value=\"Elimina il record\"></form></td></tr></table>\n";  
	    //echo "</tr></table>\n";
}
?><!-- close-->



<?//Open
  function davvero($conn, $codice) {
    $rubrica=pg_Exec($conn,"delete from PROPRIET where codice='$codice';");
    if ($rubrica) {
      tabella($conn);}
    else {
?><!-- Close-->
      <table cellpadding=15 border=0 align=center>
	<tr>
	  <td bgcolor=#ff4040>
	    <h1>Errore di cancellazione del codice <?echo "$codice"?></h1>
	  </td>
	</tr>
      </table>
<?//Open
      //echo "<table cellpadding=15 border=0 align=center><tr><td bgcolor=#ff4040>\n";
     // echo "<h1>Errore di cancellazione del codice $codice</h1>\n";
     // echo "</td></tr></table>\n";
      tabella($conn);}
  }
?><!-- Close-->

<?//Open
function modifica($conn, $codice) {//, $regione, $descrizion
?>
<table  cellpadding=15 width=80% height=60% border=0 align=center><!--tabella verde-->
  <tr>
    <td bgcolor=#40ff40 align=center valign=middle> 
      <?
	$rubrica=pg_Exec($conn,"update PROPRIET set codice='$codice',descrizion='$descrizion',regione='$regione' where codice='$codice';");
	//$rubrica=pg_Exec($conn,"update PROPRIET set codice.p='$codice',descrizion.p='$descrizion',regione.p=descriz.d from propriet as p, diz_regioni as d where codice.p='$codice';");
	if ($rubrica) {
      ?><!-- Close-->
	<table border=1><!-- -->
	  <tr>
	    <td align=center>
	      <h1>record <?echo "$codice"?> cancellato</h1>
	    </td>
	  </tr>
	</table>
    <?  //Open 
    }
    else {    
	?><!-- Close-->
	<table border=1><!-- -->
	  <tr>
	    <td align=center>
	      <h1>Errore di cancellazione del codice <?echo "$codice,$descrizion,$regione"?> </h1>
	    </td>
	  </tr>
	</table>
	<br>
	<table><!-- -->
	  <tr>
	    <td>
	      <form action=bosco.php method=get>
		<input type=submit value=Annulla>
	      </form>
	    </td>
	  </tr>
	</table>
      <?//Open  
	//echo "<table cellpadding=15 border=0 align=center><tr><td bgcolor=#ff4040>\n";
	//echo "<h1>Errore di cancellazione del codice $codice</h1\n";
	//echo "</td></tr></table>\n";}
      }
      ?>

    </td>
  </tr>
</table>
  <?
}
 ?><!-- Close-->

<?//Open 
function inserisci($conn, $codice,$regione,$descrizion) {
$result = pg_Exec( $conn, "INSERT INTO PROPRIET VALUES( '$codice', '$descrizion','$regione' );");
tabella($conn);
}


// definisco le variabili con valore indefine se non sono già definite, questa accortezza deriva dal fatto che se non lo faccio mi viene evidenziato un warning nella pagina, che dice che le variabili non sono definite
  if (!isset($_GET['azione'])) {//If not isset -> set with dumy value
    $_GET['azione'] = "undefine";
    } 
  if (!isset($_GET['codice'])) {
    $_GET['codice'] = "undefine";
    }
  if (!isset($_GET['regione']))  {
    $_GET['regione'] = "undefine";
    } 
  if (!isset($_GET['descrizion'])) {
    $_GET['descrizion'] = "undefine";
    } 

  $azione=($_GET['azione']);
  $codice=($_GET['codice']);
  $regione=($_GET['regione']);
  $descrizion=($_GET['descrizion']);


  switch ($azione) {
    case "cancella":
      conferma($conn, $codice);
      break;
    case "cancelladavvero":
      davvero($conn, $codice);
      break;
    case "modifica":
      modifica($conn, $codice);//,$regione,$descrizion
      break;
    case "Inserisci":
      inserisci($conn, $codice,$regione,$descrizion);
      break;
    default:
      tabella($conn);
      break;
  }

 ?><!-- Close-->
