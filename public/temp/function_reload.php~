<?
$boolean_values = array( 'c1', 'c2', 'c3', 'c4', 'c5',
			'p1', 'p2', 'p3', 'p4', 'p5', 'p6',
			'i3', 'i4', 'i5', 'i6', 'i7', 
			'm1', 'm2', 'm3', 'm4', 'm5', 'm6', 'm7',
			'm8', 'm9', 'm10', 'm12', 'm13', 'm14', 'm15', 
			'm16', 'm17', 'm18', 'm21', 'm22', 'm20','m23' );
$radio_values = array( 'delimitata', 'e1', 'pf1', 'o', 'p7',
			'a2', 'a3', 'a4', 'a6', 'a7',
			'r2', 'r3', 'r4', 'r5', 'r6',
			'f2', 'f3', 'f4', 'f5', 'f6', 'f7', 'f8', 'f10', 'f11');
$set_numbers = array('datasch', 'ap', 'pp', 'v1','v3', 'i1', 'i2', 'i21', 'i22', 'sup', 'sup_tot' );
  if( isset($_REQUEST['inserisci_dati']) or isset($_REQUEST['modifica_dati'])) {
$a=0; $b=0; $c=0; $d=0; $e=0; $somma=0;
	foreach( array_keys($arr) as $key ) {
		$val;
		if( in_array( $key , $boolean_values ) ) //per le variabili booleane si assegnano valori true o false
		{ 	$val = (isset($_REQUEST[$key]) and $_REQUEST[$key] != '')? 'true' : 'false'; $a++;}
		elseif( in_array( $key , $radio_values ) )  //per le variabili radio si assegnano valore null se non sono definite
		{ 	$val = (isset($_REQUEST[$key]) and $_REQUEST[$key] != '')? $_REQUEST[$key] : 'null' ; $b++;/*echo "($key,$val) ";*/}
		elseif( in_array( $key , $set_numbers ) ) 
		{ 	$val = (isset($_REQUEST[$key]) and $_REQUEST[$key] != '')? $_REQUEST[$key] : 'null' ; $d++;/*echo "($key,$val) ";*/}
		else 
		{	$val = $_REQUEST[$key] ; $e++;}
		$arr[$key] = $val ;
	}
		echo "booleani: $a , radio: $b, numeri: $d, altri: $e,totali: ".$somma=$a+$b+$d."\ ";
 	print_r($arr);
	$info = array_to_object($arr) ;
	saveInfoDescrp($info, $proprieta, $particella) ;
	unset($_REQUEST['new']) ;
  }

// --------------------------------------------------------------------

function saveInfoDescrp($dati, $proprieta, $particella) {
	
	$str_delimitata = (isset($dati->delimitata))? ", delimitata='".$dati->delimitata."'" : ", delimitata=null";
//  query corrispondente al tasto "Modifica"
$query = "UPDATE schede_a SET 
		ap=$dati->ap, pp=$dati->pp, toponimo='$dati->toponimo', datasch=$dati->datasch $str_delimitata,
		comune='$dati->comune', codiope='$dati->codiope', -- proprieta='$dati->proprieta' ,
		e1='$dati->e1', pf1='$dati->pf1' ,
		a2='$dati->a2', a3='$dati->a3', a4='$dati->a4', a6='$dati->a6' ,a7='$dati->a7' ,a8='$dati->a8',
		r2='$dati->r2', r3='$dati->r3', r4='$dati->r4', r5='$dati->r5', r6='$dati->r6', r7='$dati->r7',
		f2='$dati->f2', f3='$dati->f3', f4='$dati->f4', f5='$dati->f5', f6='$dati->f6', f7='$dati->f7', f8='$dati->f8', 
		f10='$dati->f10', f11='$dati->f11', f12='$dati->f12',
		v3=$dati->v3, v1=$dati->v1, o='$dati->o', 
		c1='$dati->c1', c2 ='$dati->c2', c3='$dati->c3', c4='$dati->c4', c5='$dati->c5',c6 ='$dati->c6',
		p1='$dati->p1', p2 ='$dati->p2', p3='$dati->p3', p4='$dati->p4', p5='$dati->p5', p6='$dati->p6', p7='$dati->p7', p8='$dati->p8', p9='$dati->p9',
		i1=$dati->i1, i2=$dati->i2, i3='$dati->i3', i4='$dati->i4', i5='$dati->i5', i6='$dati->i6',i7 ='$dati->i7', i8='$dati->i8', i21=$dati->i21, i22=$dati->i22,
		m1='$dati->m1', m2='$dati->m2', m21='$dati->m21', m3='$dati->m3', m4='$dati->m4', m22='$dati->m22', m20='$dati->m20', m5='$dati->m5' ,m6='$dati->m6', m7='$dati->m7', m8='$dati->m8',
		m9='$dati->m9', m10='$dati->m10', m12='$dati->m12', m13='$dati->m13', m15='$dati->m15', m14='$dati->m14', m23='$dati->m23',  m16='$dati->m16' ,m17='$dati->m17' ,m18='$dati->m18' ,m19='$dati->m19',
		note='$dati->note', sup=$dati->sup, sup_tot=$dati->sup_tot
	WHERE proprieta = '$proprieta' AND cod_part='$particella'
	RETURNING cod_part";

$query = "UPDATE schede_a SET 
		ap=$dati->ap, pp=$dati->pp, toponimo=$dati->toponimo, datasch=$dati->datasch $str_delimitata,
		comune=$dati->comune, codiope=$dati->codiope, -- proprieta=$dati->proprieta ,
		e1=$dati->e1, pf1=$dati->pf1 ,
		a2=$dati->a2, a3=$dati->a3, a4=$dati->a4, a6=$dati->a6 ,a7=$dati->a7 ,a8=$dati->a8,
		r2=$dati->r2, r3=$dati->r3, r4=$dati->r4, r5=$dati->r5, r6=$dati->r6, r7=$dati->r7,
		f2=$dati->f2, f3=$dati->f3, f4=$dati->f4, f5=$dati->f5, f6=$dati->f6, f7=$dati->f7, f8=$dati->f8, 
		f10=$dati->f10, f11=$dati->f11, f12=$dati->f12,
		v3=$dati->v3, v1=$dati->v1, o=$dati->o, 
		c1=$dati->c1, c2 =$dati->c2, c3=$dati->c3, c4=$dati->c4, c5=$dati->c5,c6 =$dati->c6,
		p1=$dati->p1, p2 =$dati->p2, p3=$dati->p3, p4=$dati->p4, p5=$dati->p5, p6=$dati->p6, p7=$dati->p7, p8=$dati->p8, p9=$dati->p9,
		i1=$dati->i1, i2=$dati->i2, i3=$dati->i3, i4=$dati->i4, i5=$dati->i5, i6=$dati->i6,i7 =$dati->i7, i8=$dati->i8, i21=$dati->i21, i22=$dati->i22,
		m1=$dati->m1, m2=$dati->m2, m21=$dati->m21, m3=$dati->m3, m4=$dati->m4, m22=$dati->m22, m20=$dati->m20, m5=$dati->m5 ,m6=$dati->m6, m7=$dati->m7, m8=$dati->m8,
		m9=$dati->m9, m10=$dati->m10, m12=$dati->m12, m13=$dati->m13, m15=$dati->m15, m14=$dati->m14, m23=$dati->m23,  m16=$dati->m16 ,m17=$dati->m17 ,m18=$dati->m18 ,m19=$dati->m19,
		note=$dati->note, sup=$dati->sup, sup_tot=$dati->sup_tot
	WHERE proprieta = '$proprieta' AND cod_part='$particella'
	RETURNING cod_part";
$res = pg_query($query);
	
if( pg_num_rows($res) == 0 ) {	
	$str_delimitata = (isset($dati->delimitata))? ", '".$dati->delimitata."'" : ", null";
//  query corrispondente al tasto "Inserisci"
	$query = "INSERT INTO schede_a( 
	      ap, pp, toponimo, datasch, delimitata,
	      comune, codiope, --proprieta,
	      e1,pf1, 
	      a2 ,a3 ,  a4 , a6 , a7 , a8,
	      r2, r3, r4, r5, r6, r7,
	      f2, f3, f4, f5, f6, f7, f8, f10, f11, f12,
	      v3, v1, o,
	      c1,c2, c3,c4,c5,c6,
	      p1,p2, p3, p4, p5, p6, p7, p8,  p9,
	      i1, i2, i3, i4, i5, i6, i7, i8, i21, i22,
	      m1, m2, m21, m3, m4, m22, m20, m5,m6,m7,m8,
	      m9, m10, m12, m13, m15, m14, m23, m16, m17, m18,m19,
	      note, sup, sup_tot)
		VALUES
		($dati->ap , $dati->pp , '$dati->toponimo', $dati->datasch $str_delimitata,
		 '$dati->comune' , '$dati->codiope' , --'$dati->proprieta' ,
		 '$dati->e1' , '$dati->pf1' ,
		 '$dati->a2' , '$dati->a3' , '$dati->a4' , '$dati->a6' , '$dati->a7' , '$dati->a8' ,
		'$dati->r2', '$dati->r3', '$dati->r4', '$dati->r5', '$dati->r6', '$dati->r7',
		'$dati->f2', '$dati->f3', '$dati->f4', '$dati->f5', '$dati->f6', '$dati->f7', '$dati->f8', '$dati->f10', '$dati->f11', '$dati->f12',
		$dati->v3, $dati->v1, '$dati->o', 
		'$dati->c1', '$dati->c2', '$dati->c3', '$dati->c4', '$dati->c5', '$dati->c6',
		'$dati->p1', '$dati->p2', '$dati->p3', '$dati->p4', '$dati->p5', '$dati->p6', '$dati->p7', '$dati->p8', '$dati->p9',
		$dati->i1, $dati->i2, '$dati->i3', '$dati->i4', '$dati->i5', '$dati->i6', '$dati->i7', '$dati->i8', $dati->i21, $dati->i22,
		'$dati->m1' , '$dati->m2', $dati->m21 ,'$dati->m3', '$dati->m4', $dati->m22 ,'$dati->m20' ,'$dati->m5' ,'$dati->m6' , '$dati->m7' ,'$dati->m8' ,
		'$dati->m9', '$dati->m10' , '$dati->m12' ,'$dati->m13'  ,'$dati->m15' ,'$dati->m14' ,'$dati->m23' ,'$dati->m16' ,'$dati->m17' , '$dati->m18' ,'$dati->m19',
		'$dati->note', $dati->sup, $dati->sup_tot)";	      
	$res = pg_query($query);
	}
return ($res) ;
}

?>
	<tr><td><select id='bosco_select' name='regione' onChange='javascript:bosco_form.submit();'> <!-- visualizza elenco di opzioni, menÃ¹ a tendina, necessaria voce OPTION -->
	<?php	echo "<option selected='selected' value='-1' >bosco...</option>\n";
		foreach( $ids as $id ) { 
			$selected = ( isset($_POST['regione']) and $_POST['regione'] == $id->codice )? 'selected' : ' ' ;
			echo "<option value='$id->codice' $selected> $id->descriz ($id->codice)</option>\n";}
		$id = ( isset($_POST['regione']) ) ? $_POST['regione'] : '-1' ;?>
	  </select></td>
	  <td><input TYPE="text" NAME="codice" VALUE="<?if (isset($_POST['regione'])): echo $id; endif;?>"></td>
	  <td><input TYPE="text" NAME="descrizion" VALUE=""></td>
	  <td colspan='2' style='text-align:center'><input type="submit" name="insert" value="Inserisci"></td>
	  </tr>

SELECT  d.cod_coltu , d.priorita, d.nome_itali, d.nome_scien
FROM diz_arbo AS d
ORDER BY priorita, nome_itali

"003";f;"Abete dei Nebrodi";"Abies nebrodensis (Lojac.) Mattei"

SELECT a.proprieta, a.cod_part, a.cod_fo, a.cod_coper, p.descriz, a.cod_coltu
FROM arboree a LEFT JOIN per_arbo p ON (a.cod_coper = p.codice)
WHERE proprieta='14003' AND cod_part='0002 ' AND cod_fo='1'

SELECT a.proprieta, a.cod_part, a.cod_fo, a.cod_coper, p.descriz, a.cod_coltu, d.priorita, d.nome_itali, d.nome_scien
FROM arboree a 
LEFT JOIN per_arbo p ON (a.cod_coper = p.codice)
LEFT JOIN diz_arbo AS d ON (d.cod_coltu = a.cod_coltu)
WHERE a.proprieta='14003' AND a.cod_part='0002 ' AND a.cod_fo='1'
ORDER BY d.priorita, nome_itali


SELECT d.nome_itali, d.nome_scien,  a.cod_coltu, p.descriz, a.ordine_inser
FROM arboree a 
LEFT JOIN per_arbo p ON (a.cod_coper = p.codice)
LEFT JOIN diz_arbo AS d ON (d.cod_coltu = a.cod_coltu)
WHERE a.proprieta='14003' AND a.cod_part='0002 ' AND a.cod_fo='1'
ORDER BY d.priorita, nome_itali


----------------------------
SELECT a.cod_coltu, d.priorita, d.nome_itali, d.nome_scien
FROM arbusti AS a
LEFT JOIN diz_arbo AS d ON (d.cod_coltu = a.cod_coltu)
WHERE a.proprieta='14003' AND a.cod_part='0002 ' AND a.cod_fo='1'
ORDER BY priorita, nome_itali



